{# templates/configuration/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}{{ configuration.name }}{% endblock %}

{% block body %}
<div class="min-h-screen text-white bg-gray-900">

  <!-- Header -->
  <header class="sticky top-0 z-50 px-4 py-3 bg-gray-800 border-b border-gray-700 shadow-md">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-xl font-semibold text-white">{{ configuration.name }}</h1>
        <div class="text-sm text-gray-400 mt-1">
          <a href="{{ path('configuration_index') }}" class="text-sky-400 hover:text-sky-300">‚Üê Back to Fleet</a>
        </div>
      </div>
      <a href="{{ path('configuration_edit', {id: configuration.id}) }}"
         class="px-4 py-2 text-sm bg-gray-700 hover:bg-gray-600 rounded-lg">
        Edit
      </a>
    </div>
  </header>

  <main class="pb-20">

    <!-- Axle Groups Section -->
    <section class="m-4">
      <h2 class="text-lg font-semibold mb-3">Axle Groups</h2>

      {% if axleGroups|length == 0 %}
        <div class="p-6 bg-gray-800 border border-gray-700 rounded-lg text-center">
          <p class="text-gray-400">No axle groups configured yet.</p>
          <a href="{{ path('configuration_edit', {id: configuration.id}) }}"
             class="inline-block mt-3 px-4 py-2 bg-sky-600 hover:bg-sky-700 rounded-lg">
            Add Devices
          </a>
        </div>
      {% else %}
        <div class="space-y-3">
          {% for item in axleGroups %}
            {% set axleGroup = item.entity %}
            {% set status = item.status %}
            {% set points = item.points %}

            <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-3">
                  <h3 class="text-lg font-semibold">{{ axleGroup.label }}</h3>
                  {% if status == 'good' %}
                    <span class="px-2 py-1 text-xs bg-green-900/50 text-green-400 rounded">
                      ‚úì Calibrated ({{ points }} points)
                    </span>
                  {% elseif status == 'warning' %}
                    <span class="px-2 py-1 text-xs bg-yellow-900/50 text-yellow-400 rounded">
                      ‚ö†Ô∏è Needs more points ({{ points }})
                    </span>
                  {% else %}
                    <span class="px-2 py-1 text-xs bg-red-900/50 text-red-400 rounded">
                      ‚ùå Not calibrated
                    </span>
                  {% endif %}
                </div>
                <div class="text-lg font-semibold text-white">
                  -- lbs
                </div>
              </div>

              <!-- Channels in this axle group -->
              <div class="mt-3 pt-3 border-t border-gray-700">
                <div class="text-xs text-gray-400 mb-2">Channels:</div>
                {% for channel in axleGroup.deviceChannels %}
                  <div class="flex items-center justify-between text-sm py-1">
                    <span class="text-gray-300">{{ channel.displayLabel }} ({{ channel.device.serialNumber ?: 'AS25-' ~ channel.device.id }})</span>
                    <a href="{{ path('device_calibration', {id: channel.device.id}) }}"
                       class="text-sky-400 hover:text-sky-300 text-xs">
                      Calibrate ‚Üí
                    </a>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- Bulk Calibration Button -->
        <div class="mt-4">
          <a href="{{ path('configuration_bulk_calibration', {id: configuration.id}) }}"
             class="block w-full py-4 text-center font-semibold bg-sky-600 hover:bg-sky-700 rounded-lg transition-colors">
            üìù Add Truck Scale Weights
          </a>
        </div>
      {% endif %}
    </section>

    <!-- Devices Section -->
    <section class="m-4">
      <h2 class="text-lg font-semibold mb-3">Devices ({{ configuration.deviceRoles|length }})</h2>

      {% if configuration.deviceRoles|length == 0 %}
        <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg text-center text-gray-400">
          No devices in this configuration
        </div>
      {% else %}
        <div class="space-y-2">
          {% for deviceRole in configuration.deviceRoles %}
            {% set device = deviceRole.device %}
            <a href="{{ path('device_details', {id: device.id}) }}"
               class="block p-3 bg-gray-800 border border-gray-700 rounded-lg hover:border-gray-600 transition-colors">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium">{{ device.serialNumber ?: 'AS25-' ~ device.id }}</div>
                  <div class="text-xs text-gray-400">{{ deviceRole.role }}</div>
                </div>
                <span class="text-sky-400">‚Üí</span>
              </div>
            </a>
          {% endfor %}
        </div>
      {% endif %}
    </section>

  </main>
</div>
{% endblock %}
