{# templates/configuration/_config_card.html.twig #}
<div class="p-4 bg-gray-800 border border-gray-700 rounded-lg hover:border-gray-600 transition-colors">
  <div class="flex items-start justify-between mb-3">
    <div class="flex-1">
      <div class="flex items-center gap-2">
        <h3 class="text-lg font-semibold text-white">{{ config.name }}</h3>
        {% if isActive %}
          <span class="px-2 py-1 text-xs bg-green-900/50 text-green-400 rounded">Active</span>
        {% endif %}
        {% if config.isShared %}
          <span class="px-2 py-1 text-xs bg-blue-900/50 text-blue-400 rounded flex items-center gap-1">
            <i class="fas fa-users text-xs"></i> Shared
          </span>
        {% endif %}
      </div>
      <div class="text-xs text-gray-400 mt-1">
        {% if config.isShared %}
          <span>Owned by {{ config.owner.fullName ?: config.owner.email }}</span>
          {% if config.lastUsed %}
            <span class="mx-1">•</span>
          {% endif %}
        {% endif %}
        {% if config.lastUsed %}
          <span>Last used: {{ config.lastUsed|date('M d, Y g:i A') }}</span>
        {% endif %}
      </div>
    </div>
    <div class="flex gap-2">
      <a href="{{ path('configuration_show', {id: config.id}) }}"
         class="px-3 py-1 text-sm bg-gray-700 hover:bg-gray-600 rounded transition-colors">
        View
      </a>
      {% if not isActive %}
        <button onclick="activateConfiguration({{ config.id }})"
                class="px-3 py-1 text-sm bg-sky-600 hover:bg-sky-700 rounded transition-colors">
          Activate
        </button>
      {% endif %}
    </div>
  </div>

  <!-- Axle Groups Summary -->
  {% set axleGroups = config.getAxleGroups() %}
  {% if axleGroups|length > 0 %}
    <div class="space-y-2 mb-3">
      {% for axleGroup in axleGroups %}
        {% set status = axleGroup.getCalibrationStatus() %}
        {% set points = axleGroup.getMinCalibrationPoints() %}
        <div class="flex items-center justify-between p-2 bg-gray-750 rounded">
          <div class="flex items-center gap-3 flex-1">
            <span class="text-sm font-medium text-white">{{ axleGroup.label }}</span>
            {% if status == 'good' %}
              <span class="text-xs text-green-400">✓ {{ points }} cal pts</span>
            {% elseif status == 'warning' %}
              <span class="text-xs text-yellow-400">⚠️ {{ points }} cal pts</span>
            {% else %}
              <span class="text-xs text-red-400">❌ Not calibrated</span>
            {% endif %}
          </div>
          <div class="text-sm text-gray-400">
            -- lbs
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="pt-3 border-t border-gray-700">
      <div class="flex items-center justify-between">
        <span class="text-sm font-semibold text-gray-300">TOTAL</span>
        <span class="text-lg font-semibold text-white">-- lbs</span>
      </div>
    </div>
  {% else %}
    <div class="py-4 text-center text-sm text-gray-400">
      No devices configured
    </div>
  {% endif %}

  <!-- Status Badges -->
  <div class="mt-3 pt-3 border-t border-gray-700 flex items-center justify-between">
    <div class="flex gap-2">
      {% set needsCal = false %}
      {% for axleGroup in axleGroups %}
        {% if axleGroup.getCalibrationStatus() != 'good' %}
          {% set needsCal = true %}
        {% endif %}
      {% endfor %}

      {% if needsCal %}
        <span class="px-2 py-1 text-xs bg-yellow-900/50 text-yellow-400 rounded">
          Needs Calibration
        </span>
      {% endif %}

      <span class="px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded">
        {{ config.deviceRoles|length }} device{{ config.deviceRoles|length != 1 ? 's' : '' }}
      </span>
    </div>

    <a href="{{ path('configuration_edit', {id: config.id}) }}"
       class="text-sm text-sky-400 hover:text-sky-300">
      Edit →
    </a>
  </div>
</div>
